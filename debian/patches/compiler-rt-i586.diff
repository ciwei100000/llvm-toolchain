Index: llvm-toolchain-snapshot_3.7~svn229683/compiler-rt/make/platform/clang_linux.mk
===================================================================
--- llvm-toolchain-snapshot_3.7~svn229683.orig/compiler-rt/make/platform/clang_linux.mk
+++ llvm-toolchain-snapshot_3.7~svn229683/compiler-rt/make/platform/clang_linux.mk
@@ -21,7 +21,7 @@ ifneq ($(findstring -linux-,$(CompilerTa
 
 # Define configs only if arch in triple is i386 or x86_64
 CompilerTargetArch := $(firstword $(subst -, ,$(CompilerTargetTriple)))
-ifeq ($(call contains,i386 x86_64,$(CompilerTargetArch)),true)
+ifeq ($(call contains,i386 x86_64 i586,$(CompilerTargetArch)),true)
 
 # TryCompile compiler source flags
 # Returns exit code of running a compiler invocation.
@@ -35,7 +35,7 @@ TryCompile = \
     echo $$?)
 
 test_source = $(ProjSrcRoot)/make/platform/clang_linux_test_input.c
-ifeq ($(CompilerTargetArch),i386)
+ifneq (,$(filter $(CompilerTargetArch),i386 i586))
   SupportedArches := i386
   ifeq ($(call TryCompile,$(CC),$(test_source),-m64),0)
     SupportedArches += x86_64
Index: llvm-toolchain-snapshot_3.7~svn229683/clang/runtime/compiler-rt/Makefile
===================================================================
--- llvm-toolchain-snapshot_3.7~svn229683.orig/clang/runtime/compiler-rt/Makefile
+++ llvm-toolchain-snapshot_3.7~svn229683/clang/runtime/compiler-rt/Makefile
@@ -165,6 +165,7 @@ BuildRuntimeLibraries:
 	  ProjSrcRoot=$(COMPILERRT_SRC_ROOT) \
 	  ProjObjRoot=$(PROJ_OBJ_DIR) \
 	  CC="$(ToolDir)/clang" \
+	  LD_LIBRARY_PATH=../build-llvm/Release/lib \
 	  VERBOSE=$(VERBOSE) \
 	  LLVM_ANDROID_TOOLCHAIN_DIR="$(LLVM_ANDROID_TOOLCHAIN_DIR)" \
 	  $(RuntimeDirs:%=clang_%)
